<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Go#Chenk Laundry System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --primary: #0d6efd; --bg: #f4f7fe; }
        body { background-color: var(--bg); font-family: 'Inter', sans-serif; }
        .card { border: none; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.02); }
        .nav-pills .nav-link { border-radius: 12px; padding: 12px; font-weight: 600; color: #6c757d; }
        .nav-pills .nav-link.active { background-color: var(--primary); box-shadow: 0 4px 15px rgba(13,110,253,0.3); }
        
        #area-nota { background: white; border: 1px solid #eee; border-radius: 15px; padding: 20px; font-family: monospace; }
        @media print {
            body * { visibility: hidden; }
            #area-nota, #area-nota * { visibility: visible; }
            #area-nota { position: absolute; left: 0; top: 0; width: 100%; border: none; padding: 0; }
        }
        .stat-card { border-left: 5px solid var(--primary); }
    </style>
</head>
<body>

<nav class="navbar navbar-dark bg-primary py-3 mb-4 no-print">
    <div class="container"><span class="navbar-brand fw-bold"><i class="bi bi-water me-2"></i>GO#CHENK LAUNDRY</span></div>
</nav>

<div class="container no-print">
    <ul class="nav nav-pills nav-fill mb-4 bg-white p-2 rounded-4 shadow-sm" id="pills-tab" role="tablist">
        <li class="nav-item"><button class="nav-link active" data-bs-toggle="pill" data-bs-target="#tab-order" type="button">Order Baru</button></li>
        <li class="nav-item"><button class="nav-link" data-bs-toggle="pill" data-bs-target="#tab-riwayat" type="button" onclick="loadRiwayat()">Riwayat</button></li>
        <li class="nav-item"><button class="nav-link" data-bs-toggle="pill" data-bs-target="#tab-keuangan" type="button" onclick="loadKeuangan()">Keuangan</button></li>
    </ul>

    <div class="tab-content">
        <div class="tab-pane fade show active" id="tab-order">
            <div class="row g-4">
                <div class="col-lg-7">
                    <div class="card p-4">
                        <form id="f-order" oninput="hitung()">
                            <h5 class="fw-bold mb-4">Form Transaksi</h5>
                            <input type="text" id="nama" class="form-control mb-3" placeholder="Nama Pelanggan" required>
                            
                            <div class="row g-2 mb-3">
                                <div class="col-6">
                                    <label class="small fw-bold">Jenis Laundry</label>
                                    <select id="jenis" class="form-select" onchange="toggleLayanan()">
                                        <option value="Kiloan">Kiloan</option>
                                        <option value="Satuan">Satuan</option>
                                    </select>
                                </div>
                                <div id="box-durasi" class="col-6">
                                    <label class="small fw-bold">Durasi</label>
                                    <select id="durasi" class="form-select" onchange="hitung()">
                                        <option value="1">1 Hari</option>
                                        <option value="2">2 Hari</option>
                                        <option value="3">3 Hari</option>
                                        <option id="opt-4hari" value="4">4 Hari</option>
                                    </select>
                                </div>
                            </div>

                            <div id="area-kiloan">
                                <div class="row g-2 mb-3">
                                    <div class="col-8">
                                        <label class="small fw-bold">Pilihan Jasa</label>
                                        <select id="jasa" class="form-select" onchange="cekDurasi(); hitung();">
                                            <option value="Cuci Setrika">Cuci Setrika</option>
                                            <option value="Cuci Lipat">Cuci Lipat</option>
                                            <option value="Setrika Saja">Setrika Saja</option>
                                        </select>
                                    </div>
                                    <div class="col-4">
                                        <label class="small fw-bold">Berat (Kg)</label>
                                        <input type="number" id="berat" class="form-control" value="2" min="2">
                                    </div>
                                </div>
                            </div>

                            <div id="area-satuan" style="display:none">
                                <label class="small fw-bold">Input Satuan Manual</label>
                                <input type="text" id="item" class="form-control mb-2" placeholder="Nama Barang (Contoh: Bedcover)">
                                <input type="number" id="hargaS" class="form-control mb-3" placeholder="Harga Total (Rp)">
                            </div>

                            <label class="small fw-bold">Pembayaran DP</label>
                            <input type="number" id="dp" class="form-control mb-4" placeholder="Rp 0">
                            
                            <button type="button" onclick="simpan()" id="btn-simpan" class="btn btn-primary w-100 fw-bold shadow">SIMPAN TRANSAKSI</button>
                        </form>
                    </div>
                </div>

                <div class="col-lg-5">
                    <div id="area-nota shadow-sm">
                        <div class="text-center">
                            <h5 class="fw-bold m-0">GO#CHENK LAUNDRY</h5>
                            <small>Struk Bukti Laundry</small>
                        </div>
                        <hr style="border-top: 1px dashed #000">
                        <div class="small">
                            <div class="d-flex justify-content-between"><span>Customer:</span><b id="n-nama">-</b></div>
                            <div class="d-flex justify-content-between"><span>Layanan:</span><span id="n-lay">-</span></div>
                            <div class="d-flex justify-content-between"><span>Detail:</span><span id="n-det">-</span></div>
                            <hr style="border-top: 1px dashed #000">
                            <div class="d-flex justify-content-between fw-bold"><span>TOTAL:</span><span>Rp <span id="n-tot">0</span></span></div>
                            <div class="d-flex justify-content-between"><span>DP:</span><span>Rp <span id="n-dp">0</span></span></div>
                            <div class="d-flex justify-content-between text-danger fw-bold"><span>SISA:</span><span>Rp <span id="n-sis">0</span></span></div>
                        </div>
                        <button class="btn btn-sm btn-dark w-100 mt-4 no-print" onclick="window.print()"><i class="bi bi-printer me-2"></i>CETAK NOTA</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="tab-pane fade" id="tab-riwayat">...</div>
        <div class="tab-pane fade" id="tab-keuangan">...</div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzVMr65IgQq2e_ODQjpxYSUDBctcIVYfjogTWIK-CipllMjTTgBPfHFvFT5tIB4SftH/exec"; 

    function toggleLayanan() {
        const j = document.getElementById('jenis').value;
        document.getElementById('area-kiloan').style.display = j==='Kiloan'?'block':'none';
        document.getElementById('box-durasi').style.display = j==='Kiloan'?'block':'none';
        document.getElementById('area-satuan').style.display = j==='Satuan'?'block':'none';
        cekDurasi();
        hitung();
    }

    // Fungsi baru untuk membatasi opsi 4 hari pada Cuci Lipat & Setrika Saja
    function cekDurasi() {
        const jasa = document.getElementById('jasa').value;
        const opt4 = document.getElementById('opt-4hari');
        const durasiSelect = document.getElementById('durasi');

        if (jasa === "Cuci Lipat" || jasa === "Setrika Saja") {
            opt4.disabled = true;
            if (durasiSelect.value === "4") durasiSelect.value = "3";
        } else {
            opt4.disabled = false;
        }
    }

    function hitung() {
        const j = document.getElementById('jenis').value;
        let t = 0, lay = "", det = "";

        if(j === 'Kiloan') {
            const jasa = document.getElementById('jasa').value;
            const dur = parseInt(document.getElementById('durasi').value);
            const b = Math.max(2, parseFloat(document.getElementById('berat').value||0));
            let h = 0;

            if(jasa === 'Cuci Setrika') {
                // Harga: 1hr=10rb, 2hr=7rb, 3hr=6rb, 4hr=5rb
                h = [0, 10000, 7000, 6000, 5000][dur];
            } else {
                // Cuci Lipat & Setrika Saja: 1hr=7rb, 2hr=5rb, 3hr=4rb (4hr tidak ada/ikut 3hr)
                h = [0, 7000, 5000, 4000, 4000][dur];
            }
            
            t = h * b;
            lay = jasa + " (" + dur + "hr)";
            det = b + "kg @" + h.toLocaleString();
        } else {
            // SATUAN: Diisi Manual
            t = parseInt(document.getElementById('hargaS').value || 0);
            lay = "Satuan: " + (document.getElementById('item').value || "-");
            det = "Harga Satuan Manual";
        }

        const dp = parseInt(document.getElementById('dp').value || 0);
        document.getElementById('n-nama').innerText = document.getElementById('nama').value || "-";
        document.getElementById('n-lay').innerText = lay;
        document.getElementById('n-det').innerText = det;
        document.getElementById('n-tot').innerText = t.toLocaleString();
        document.getElementById('n-dp').innerText = dp.toLocaleString();
        document.getElementById('n-sis').innerText = (t-dp).toLocaleString();
        return {t, lay};
    }

    // Sisanya (simpan, loadRiwayat, update, loadKeuangan) tetap sama seperti kode sebelumnya
    async function simpan() { ... }
    async function loadRiwayat() { ... }
    async function update(id, type, val) { ... }
    async function loadKeuangan() { ... }

    window.onload = function() {
        toggleLayanan();
        loadRiwayat();
    };
</script>
</body>
</html>
