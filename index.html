<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Go#Chenk Loundry System</title>
    <style>
        :root { --primary: #1a73e8; --secondary: #34a853; --dark: #3c4043; --light: #f8f9fa; --border: #ddd; --warning: #fbbc04; --danger: #ea4335; }
        body { font-family: 'Segoe UI', sans-serif; margin: 0; background: var(--light); color: var(--dark); padding-bottom: 80px; }
        .main-header { background: var(--primary); color: white; padding: 15px; text-align: center; position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .main-header h1 { margin: 0; font-size: 18px; text-transform: uppercase; letter-spacing: 1px; }
        .container { padding: 15px; max-width: 800px; margin: auto; }
        .card { background: white; padding: 15px; border-radius: 10px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); margin-bottom: 15px; }
        .tab-bar { display: flex; background: white; position: fixed; bottom: 0; width: 100%; box-shadow: 0 -2px 10px rgba(0,0,0,0.1); z-index: 1000; }
        .tab-btn { flex: 1; padding: 12px; border: none; background: white; color: #777; font-size: 11px; cursor: pointer; display: flex; flex-direction: column; align-items: center; }
        .tab-btn.active { color: var(--primary); font-weight: bold; border-top: 3px solid var(--primary); background: #f0f7ff; }
        .form-grid { display: grid; gap: 10px; }
        label { font-size: 11px; font-weight: bold; color: var(--primary); margin-bottom: -5px; }
        input, select, button { width: 100%; padding: 12px; border: 1px solid var(--border); border-radius: 6px; box-sizing: border-box; font-size: 14px; }
        .btn-primary { background: var(--primary); color: white; border: none; font-weight: bold; cursor: pointer; }
        .btn-success { background: var(--secondary); color: white; border: none; font-weight: bold; cursor: pointer; }
        .btn-danger { background: var(--danger); color: white; border: none; padding: 5px 8px; border-radius: 4px; cursor: pointer; }
        .btn-lunas { background: var(--secondary); color: white; border: none; padding: 5px 8px; border-radius: 4px; cursor: pointer; font-size: 10px; }
        table { width: 100%; border-collapse: collapse; font-size: 12px; margin-top: 10px; }
        th, td { padding: 10px; border-bottom: 1px solid #eee; text-align: left; }
        .badge { padding: 4px 8px; border-radius: 10px; font-size: 10px; font-weight: bold; color: white; text-transform: uppercase; }
        .badge-lunas { background: var(--secondary); }
        .badge-dp { background: var(--warning); color: #000; }
        .hidden { display: none; }
        #area-cetak-nota { background: #fff; padding: 20px; max-width: 320px; margin: auto; font-family: 'Courier New', monospace; border: 1px solid #ddd; color: #000; }
        .nota-row { display: flex; justify-content: space-between; margin: 4px 0; }
        .nota-divider { border-top: 1px dashed #000; margin: 10px 0; }
        @media print { body * { visibility: hidden; } #area-cetak-nota, #area-cetak-nota * { visibility: visible; } #area-cetak-nota { position: absolute; left: 0; top: 0; width: 100%; border: none; } }
    </style>
</head>
<body>

<header class="main-header">
    <h1>Go#Chenk Loundry</h1>
</header>

<div class="container">
    
    <div id="tab-laundry" class="tab-content">
        <div class="card">
            <h3>üè† Transaksi Cepat</h3>
            <div class="form-grid">
                <label>Tanggal & Hari</label>
                <input type="date" id="manTgl">
                <input type="text" id="manNama" placeholder="Nama Pelanggan">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                    <input type="number" id="manBerat" placeholder="Berat (Kg)">
                    <select id="manJasa" onchange="updateHargaTransaksi()">
                        <option value="Cuci Gosok">Cuci Gosok</option>
                        <option value="Cuci Lipat">Cuci Lipat</option>
                        <option value="Setrika">Setrika Saja</option>
                    </select>
                </div>
                <label>Durasi Paket</label>
                <select id="manPaket"></select>
                <input type="number" id="manBayar" placeholder="Jumlah Bayar/DP (Rp)">
                <button class="btn-primary" onclick="simpanTransaksiManual()">üíæ SIMPAN TRANSAKSI</button>
            </div>
        </div>
        <div class="card">
            <div style="overflow-x:auto">
                <table>
                    <thead><tr><th>Hari/Tgl</th><th>Nama/Jasa</th><th>Total</th><th>Status</th><th>Aksi</th></tr></thead>
                    <tbody id="bodyLaundry"></tbody>
                </table>
            </div>
        </div>
    </div>

    <div id="tab-keuangan" class="tab-content hidden">
        <div class="card">
            <h3>üí∞ Kas Masuk & Keluar</h3>
            <div class="form-grid">
                <input type="date" id="kasTgl">
                <select id="kasJenis">
                    <option value="masuk">üü¢ Pemasukan Lain</option>
                    <option value="keluar">üî¥ Pengeluaran</option>
                </select>
                <input type="text" id="kasKet" placeholder="Keterangan (Contoh: Beli Sabun)">
                <input type="number" id="kasNominal" placeholder="Nominal (Rp)">
                <button class="btn-primary" onclick="simpanKasManual()">‚ûï CATAT KAS</button>
            </div>
        </div>
        <div class="card">
            <div style="display:flex; gap:10px; margin-bottom:15px; text-align:center;">
                <div style="flex:1; background:#d4edda; padding:10px; border-radius:8px;">Masuk<br><b id="totalMasuk">0</b></div>
                <div style="flex:1; background:#f8d7da; padding:10px; border-radius:8px;">Keluar<br><b id="totalKeluar">0</b></div>
                <div style="flex:1; background:#e2e3e5; padding:10px; border-radius:8px;">Saldo<br><b id="totalSaldo">0</b></div>
            </div>
            <table><tbody id="bodyKas"></tbody></table>
        </div>
    </div>

    <div id="tab-nota" class="tab-content hidden">
        <div id="form-nota-container" class="card">
            <h3>üñ®Ô∏è Buat Nota Baru</h3>
            <div class="form-grid">
                <label>Tanggal Nota</label>
                <input type="date" id="notaTgl">
                <input type="text" id="notaNama" placeholder="NAMA PELANGGAN">
                <select id="notaJasa" onchange="updateHargaNota()">
                    <option value="Cuci Gosok">Cuci Gosok</option>
                    <option value="Cuci Lipat">Cuci Lipat</option>
                    <option value="Setrika">Setrika Saja</option>
                </select>
                <select id="notaPaket"></select>
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                    <input type="number" id="notaBerat" value="1" placeholder="Berat (Kg)">
                    <input type="number" id="notaDP" value="0" placeholder="Bayar/DP (Rp)">
                </div>
                <button class="btn-primary" onclick="tampilkanPreview()">üëÅÔ∏è PREVIEW NOTA</button>
            </div>
        </div>

        <div id="preview-nota-container" class="hidden">
            <button class="btn-danger" style="margin-bottom: 10px;" onclick="batalNota()">‚¨ÖÔ∏è EDIT DATA</button>
            <div id="area-cetak-nota">
                <center><strong>GO#CHENK LOUNDRY</strong><br><small>Bersih - Cepat - Rapi</small></center>
                <div class="nota-divider"></div>
                <div class="nota-row"><span>Tgl:</span> <span id="dispTgl"></span></div>
                <div class="nota-row"><span>Nama:</span> <span id="dispNama"></span></div>
                <div class="nota-divider"></div>
                <div class="nota-row"><span id="dispJasa"></span> <span id="dispSubtotal"></span></div>
                <div class="nota-row"><small id="dispDetail"></small></div>
                <div class="nota-divider"></div>
                <div class="nota-row"><strong>TOTAL:</strong> <strong id="dispTotal"></strong></div>
                <div class="nota-row"><span>BAYAR:</span> <span id="dispDP"></span></div>
                <div class="nota-row" style="color:red"><span>SISA:</span> <span id="dispSisa"></span></div>
                <div class="nota-divider"></div>
                <center><small>Terima kasih atas kepercayaan Anda!</small></center>
            </div>
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-top:15px;">
                <button class="btn-success" id="btnSimpanNota" onclick="prosesSimpanNota()">üíæ SIMPAN DATA</button>
                <button style="background:#000; color:#fff;" onclick="window.print()">üñ®Ô∏è CETAK NOTA</button>
            </div>
        </div>
    </div>

</div>

<div class="tab-bar">
    <button class="tab-btn active" onclick="changeTab('tab-laundry', this)">üè†<br>Transaksi</button>
    <button class="tab-btn" onclick="changeTab('tab-keuangan', this)">üí∞<br>Keuangan</button>
    <button class="tab-btn" onclick="changeTab('tab-nota', this)">üñ®Ô∏è<br>Nota</button>
</div>

<script>
    let dbLaundry = JSON.parse(localStorage.getItem('dbLaundry')) || [];
    let dbKas = JSON.parse(localStorage.getItem('dbKas')) || [];

    const namaHari = ["Minggu", "Senin", "Selasa", "Rabu", "Kamis", "Jumat", "Sabtu"];
    function formatFull(tglStr) {
        const d = new Date(tglStr);
        return namaHari[d.getDay()] + ", " + d.toLocaleDateString('id-ID');
    }

    // Update Harga Otomatis untuk Transaksi & Nota
    function getPaketHTML(jasa) {
        return jasa === "Cuci Gosok" ? 
            `<option value="10000">1 Hari (10rb)</option><option value="7000">2 Hari (7rb)</option><option value="5000">3 Hari (5rb)</option>` : 
            `<option value="7000">1 Hari (7rb)</option><option value="5000">2 Hari (5rb)</option><option value="4000">3 Hari (4rb)</option>`;
    }

    function updateHargaTransaksi() { document.getElementById('manPaket').innerHTML = getPaketHTML(document.getElementById('manJasa').value); }
    function updateHargaNota() { document.getElementById('notaPaket').innerHTML = getPaketHTML(document.getElementById('notaJasa').value); }

    function changeTab(tabId, btn) {
        document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden'));
        document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
        document.getElementById(tabId).classList.remove('hidden');
        btn.classList.add('active');
        if(tabId === 'tab-nota') { batalNota(); updateHargaNota(); }
        if(tabId === 'tab-laundry') { updateHargaTransaksi(); }
        updateUI();
    }

    function simpanTransaksiManual() {
        const t = document.getElementById('manTgl').value, n = document.getElementById('manNama').value, b = parseFloat(document.getElementById('manBerat').value), j = document.getElementById('manJasa').value, h = parseInt(document.getElementById('manPaket').value), d = parseInt(document.getElementById('manBayar').value) || 0;
        if(!t || !n || !b) return alert("Isi data!");
        
        const total = b * h;
        const durasiText = document.getElementById('manPaket').options[document.getElementById('manPaket').selectedIndex].text.split(' ')[0] + " Hr";
        
        dbLaundry.unshift({ tgl: formatFull(t), raw: t, nama: n, jasa: j + " ("+durasiText+")", total: total, bayar: d, status: (d>=total?'Lunas':'Uang Muka') });
        if(d > 0) dbKas.unshift({ tgl: formatFull(t), raw: t, ket: 'Laundry: '+n, jenis: 'masuk', nominal: d });
        save(); updateUI();
        document.getElementById('manNama').value = ''; document.getElementById('manBerat').value = ''; document.getElementById('manBayar').value = '';
    }

    function lunaskan(idx) {
        const d = dbLaundry[idx];
        const sisa = d.total - d.bayar;
        if(confirm("Pelunasan Rp" + sisa.toLocaleString() + "?")) {
            dbLaundry[idx].bayar = d.total;
            dbLaundry[idx].status = "Lunas";
            dbKas.unshift({ tgl: formatFull(new Date()), raw: new Date().toISOString().split('T')[0], ket: 'Pelunasan: '+d.nama, jenis: 'masuk', nominal: sisa });
            save(); updateUI();
        }
    }

    function simpanKasManual() {
        const t = document.getElementById('kasTgl').value, j = document.getElementById('kasJenis').value, k = document.getElementById('kasKet').value, n = parseInt(document.getElementById('kasNominal').value);
        if(!t || !k || !n) return alert("Lengkapi data kas!");
        dbKas.unshift({ tgl: formatFull(t), raw: t, ket: k, jenis: j, nominal: n });
        save(); updateUI();
        document.getElementById('kasKet').value = ''; document.getElementById('kasNominal').value = '';
    }

    function tampilkanPreview() {
        const t = document.getElementById('notaTgl').value, n = document.getElementById('notaNama').value, b = parseFloat(document.getElementById('notaBerat').value), h = parseInt(document.getElementById('notaPaket').value), dp = parseInt(document.getElementById('notaDP').value) || 0;
        if(!t || !n || !b) return alert("Data tidak lengkap!");
        const durasiText = document.getElementById('notaPaket').options[document.getElementById('notaPaket').selectedIndex].text;
        
        document.getElementById('dispTgl').innerText = formatFull(t);
        document.getElementById('dispNama').innerText = n.toUpperCase();
        document.getElementById('dispJasa').innerText = document.getElementById('notaJasa').value + " ("+durasiText+")";
        document.getElementById('dispDetail').innerText = b + "kg x Rp" + h.toLocaleString();
        document.getElementById('dispSubtotal').innerText = "Rp" + (b*h).toLocaleString();
        document.getElementById('dispTotal').innerText = "Rp" + (b*h).toLocaleString();
        document.getElementById('dispDP').innerText = "Rp" + dp.toLocaleString();
        document.getElementById('dispSisa').innerText = "Rp" + (b*h - dp).toLocaleString();
        
        document.getElementById('form-nota-container').classList.add('hidden');
        document.getElementById('preview-nota-container').classList.remove('hidden');
        document.getElementById('btnSimpanNota').disabled = false;
        document.getElementById('btnSimpanNota').innerText = "üíæ SIMPAN DATA";
    }

    function batalNota() { document.getElementById('form-nota-container').classList.remove('hidden'); document.getElementById('preview-nota-container').classList.add('hidden'); }

    function prosesSimpanNota() {
        const t = document.getElementById('notaTgl').value, n = document.getElementById('notaNama').value, b = parseFloat(document.getElementById('notaBerat').value), h = parseInt(document.getElementById('notaPaket').value), dp = parseInt(document.getElementById('notaDP').value) || 0;
        const tot = b*h;
        const durasiText = document.getElementById('notaPaket').options[document.getElementById('notaPaket').selectedIndex].text.split(' ')[0] + " Hr";
        dbLaundry.unshift({ tgl: formatFull(t), raw: t, nama: n, jasa: document.getElementById('notaJasa').value + " ("+durasiText+")", total: tot, bayar: dp, status: (dp>=tot?'Lunas':'Uang Muka') });
        if(dp > 0) dbKas.unshift({ tgl: formatFull(t), raw: t, ket: 'Laundry: '+n, jenis: 'masuk', nominal: dp });
        save(); updateUI();
        document.getElementById('btnSimpanNota').disabled = true;
        document.getElementById('btnSimpanNota').innerText = "‚úÖ TERSIMPAN";
    }

    function save() { localStorage.setItem('dbLaundry', JSON.stringify(dbLaundry)); localStorage.setItem('dbKas', JSON.stringify(dbKas)); }

    function updateUI() {
        let hL = "";
        dbLaundry.forEach((i, idx) => {
            const isL = i.status === 'Lunas';
            hL += `<tr><td>${i.tgl}</td><td><b>${i.nama}</b><br><small>${i.jasa}</small><br><small>Sisa: ${(i.total-i.bayar).toLocaleString()}</small></td><td>${i.total.toLocaleString()}</td><td><span class="badge ${isL?'badge-lunas':'badge-dp'}">${i.status}</span></td><td>${!isL?`<button class="btn-lunas" onclick="lunaskan(${idx})">LUNAS</button>`:''} <button class="btn-danger" onclick="hapus('laundry',${idx})">X</button></td></tr>`;
        });
        document.getElementById('bodyLaundry').innerHTML = hL;

        let hK = "", m = 0, k = 0;
        dbKas.forEach((i, idx) => {
            if(i.jenis === 'masuk') m += i.nominal; else k += i.nominal;
            hK += `<tr><td>${i.tgl}</td><td>${i.ket}</td><td style="color:${i.jenis==='masuk'?'green':'red'}">${i.nominal.toLocaleString()}</td><td><button class="btn-danger" onclick="hapus('kas',${idx})">X</button></td></tr>`;
        });
        document.getElementById('bodyKas').innerHTML = hK;
        document.getElementById('totalMasuk').innerText = m.toLocaleString();
        document.getElementById('totalKeluar').innerText = k.toLocaleString();
        document.getElementById('totalSaldo').innerText = (m-k).toLocaleString();
    }

    function hapus(type, idx) { if(confirm("Hapus data?")) { if(type==='laundry') dbLaundry.splice(idx,1); else dbKas.splice(idx,1); save(); updateUI(); } }

    window.onload = function() {
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('manTgl').value = today;
        document.getElementById('kasTgl').value = today;
        document.getElementById('notaTgl').value = today;
        updateHargaTransaksi();
        updateUI();
    };
</script>
</body>
</html>
